De Montmort problem, or counting the derangements
The problem was originally posed by Pierre Remond de Montmort in 1708, and was solved by him and, independently, Nicholas Bernoulli.

De Montmort stated it in terms of a game of cards, later it became popular in the following formulation:

quote
The guests leaving a party are taking their hats in the garderobe.
In the darkness they cannot tell the hats one from the other, so everybody takes a hat by chance.
What is the probability that nobody will get his own hat?
quote

Here is a formal description of the problem.
Consider a bijection

f 1, 2, , n 1, 2, , n.

Such a bijection is called a permutation.
An element  is called a fixed point of  if .
A permutation without fixed points is sometimes called a derangement.
The probability to be computed is equal to

derangementspermutations.

The number of permutations is known: it is .
Thus we have to count the number of derangements.
