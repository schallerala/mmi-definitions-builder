\input{preamble.tex}
\begin{document}
\setcounter{section}{5}
\setcounter{subsection}{2}
\setcounter{dfn}{8}

\begin{proof}
Let $G$ be a context-free grammar possibly containing $\epsilon$- and unit productions.
We construct a grammar $G'$ without $\epsilon$-productions such that $L(G') = L(G) \setminus \{\epsilon\}$.

First, identify \emph{nullable} variables, those which derive $\epsilon$.
This is done recursively.
Initialize the set of nullable variables by those $A$ for which there is a production $(A \to \epsilon) \in P$.
The recursion step adds to the set of nullable variables those $B$ for which $(B \to C_1 \cdots C_k) \in P$
and all $C_1, \ldots C_k$ are nullable.
As soon as this recursion does not find new nullable variables, the algorithm stops.

Second, remove from $P$ all $\epsilon$-productions $A \to \epsilon$ and add new productions in the following way.
Let $A \to X_1 \cdots X_n$ be a production with some of $X_i$ nullable variables
(recall that $X_i$ can stand for a variable symbol as well as for a terminal symbol).
We add all productions of the form $A \to X_1 \widehat{\cdots} X_n$,
where $\widehat{\cdots}$ means that we remove any subset of nullable variables
(with one exception: if all $X_1, \ldots, X_n$ are nullable,
then we do not add the production $A \to \epsilon$ obtained by removing all nullable variables).
That is, if $m$ symbols among $X_1, \ldots X_n$ are nullable variables, then the production $A \to X_1 \cdots X_n$
gives rise to $2^m$ productions if $m < n$ and to $2^n - 1$ productions if $m=n$.

It can be checked that the new set of productions allows to derive all words (except $\epsilon$) which were derivable
with the initial set of productions, and only those words.

Now we construct a grammar $G''$ equivalent to $G'$ but without unit productions.
Call a pair $(A, B)$ \emph{unit pair}, if $A \xRightarrow[]{*} B$.
The set of all unit pairs can be found recursively.

Remove all unit productions, and for each unit pair $(A, B)$ and each non-unit production $B \to \alpha$ add the production $A \to \alpha$.
Every word generated by the grammar $G''$ is also generated by $G'$:
the new direct productions $A \xRightarrow[G'']{} \alpha$ are compositions of two old productions
$\alpha A \beta \xRightarrow[G']{} \alpha B \beta \xRightarrow[G']{} \alpha$.
Every word generated by $G'$ is generated by $G''$: a series of unit productions must always end with a non-unit production,
so if we had $\alpha A \gamma \xRightarrow[G']{*} \alpha B \gamma \xRightarrow[G']{} \alpha\beta\gamma$,
then we have $\alpha A \gamma \xRightarrow[G''] \alpha\beta\gamma$.
Thus the new set of productions generates the same language as before.
\end{proof}
It is important to remove first the $\epsilon$-productions and then the unit productions.
If first the unit, and then $\epsilon$-productions are removed, then the result might contain unit productions.


\end{document}
